Consulta 1:
SELECT
  c.idcancha,
  c.deporte,
  ROUND(
    COUNT(r.idreserva)::NUMERIC / GREATEST(
      (MAX(r.fecha) - MIN(r.fecha)) + 1, 1
    ), 2
  ) AS reservas_por_dia
FROM cancha c
LEFT JOIN reserva r
  ON c.idcancha = r.idcancha
     AND r.estado <> 'cancelado'
GROUP BY c.idcancha, c.deporte
ORDER BY reservas_por_dia DESC
LIMIT 5;


Consulta 2:
SELECT
  u.idusuario,
  u.nombre,
  SUM(EXTRACT(EPOCH FROM (r.horafin - r.horainicio)) / 3600) AS horas_totales,
  COUNT(r.idreserva) AS num_reservas
FROM usuario u
JOIN reserva r ON u.dni = r.dni
GROUP BY u.idusuario, u.nombre
HAVING
  SUM(EXTRACT(EPOCH FROM (r.horafin - r.horainicio)) / 3600) > 100
  AND COUNT(r.idreserva) >= 5
ORDER BY horas_totales DESC
LIMIT 10;


Consulta 3:
SELECT
  c.idcancha,
  SUM(p.monto) AS ingresos_totales
FROM cancha c
JOIN reserva r ON c.idcancha = r.idcancha
JOIN pago p ON r.idreserva = p.idreserva
WHERE p.fechapago BETWEEN '2025-01-01' AND '2025-06-30'
GROUP BY c.idcancha
ORDER BY ingresos_totales DESC
LIMIT 5;


Consulta 4:
SELECT
  idcancha,
  ROUND(
    COUNT(*) FILTER (WHERE estado = 'cancelado')::NUMERIC
    / GREATEST(COUNT(*), 1) * 100, 2
  ) AS pct_cancelaciones
FROM reserva
GROUP BY idcancha
ORDER BY pct_cancelaciones DESC
LIMIT 5;
